
基于Django的新正方教务管理系统的爬虫webApi，请求**返回JSON数据**

部分本地API基于[NeroAsmarr/zfnew](https://github.com/NeroAsmarr/zfnew)【2020.2.16】

目前项目部署在“西院助手”微信小程序中作为API测试（临时，后将重构为云开发nodejs爬虫）

求⭐⭐⭐⭐⭐（跪

## 使用方法

### JSON数据键值参照

 - 点击[JSON键值](#JSON键值)访问返回的JSON数据键值名称参照

### Tips

 - 通过pinfo新增学生，并将cookies存入数据库
 - 请求其它内容时，cookies失效后将重新执行登录，并更新数据库中的两个cookies字段和updateTime字段以及增加refreshTimes次数字段（请求内容失败可能并不完全是因为cookies失效，但目前暂未遇到其它错误，且更新cookies也是一个较为通用的解决办法）
 - config.json中的proxy为**http代理**
 - 选课API可能**并不通用**，这里仅提供思路，具体请参照自己学校情况
 - 代码中有关于开发者本校的**录取查询(recruitApp)**，**不通用**，请自行编写替换或删除
 - 鉴于实现方式和并发量，并**不推荐**将本项目部署到产品项目中
 - CentOs自带的sqlite3版本较低，**Django2.1.8**以上不兼容
     - 解决办法一：通过requirements.txt安装模块，将requirements.txt中的Django版本**更改为2.1.8**
     - 解决办法二：升级自带的sqlite3版本，并重新链接（移步百度
 - **部署的时候代码中Server酱部分麻烦换成自己的**🙏

### POST地址&Data
#### 请求信息
```
个人信息(必须，用以登录)：xxx:8000/info/pinfo
※信息FromData={xh:'学号',pswd:'密码'}

停补换课消息：xxx:8000/info/message
※消息FromData={xh:'学号',pswd:'密码'}

课程修读情况(学业详情)：xxx:8000/info/study
※学业FromData={xh:'学号',pswd:'密码'}

请求成绩: xxx:8000/info/grade
※成绩FromData={xh:'学号',pswd:'密码',year:'查询学年',term:'查询学期'}

请求课表：xxx:8000/info/schedule
※课表FromData={xh:'学号',pswd:'密码',year:'查询学年',term:'查询学期'}

手动更新cookies：xxx:8000/info/update
※更新FromData={xh:'学号',pswd:'密码'}
```
#### 选课请求
```
请求已选课程：xxx:8000/choose/choosed
※已选FromData={xh:'学号',pswd:'密码'}

板块课：xxx:8000/choose/bkk
板块课FromData={xh:'学号',pswd:'密码',bkk:'1 or 2'}

(Todo)选择某课：xxx:8000/choose/confirm
※选课FromData={xh:'学号',pswd:'密码',id:'教学班ID'}

(Todo)退掉某课：xxx:8000/choose/cancel
※退课FromData={xh:'学号',pswd:'密码',id:'教学班ID'}
```

### 额外请求
```
one·一个 每日文字：xxx:8000/one
※GET请求

录取查询（通过开发者所在学校招生网获取数据，不通用）：xxx:8000/recruit/ksh(idcard)
※录取FromData={ksh:'考生号'(idcard:'身份证号')}
```

## 使用部署
 - 推荐使用**uswgi+nginx**，具体部署可移步百度
 - 更改config.json中各项：base_url为学校教务系统网址，proxy为http代理

## 测试部署(建议仅测试用)

 - 请确保服务器或虚拟环境安装了**Python3.6**及以上版本

### 1.安装依赖模块

```shell
$ pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt
```

### 2.开放安全组配置
 - 开放80、8000端口

### 3.用终端打开zfnweb文件夹，并运行

```shell
$ python manage.py runserver 0.0.0.0:8000
```

访问你服务器的**IP地址:8000**

# JSON键值

## 个人信息（登录）

```json
{
    "name": "学生姓名",
    "studentId": "学生学号",
    "birthDay": "出生日期",
    "idNumber": "身份证号码",
    "candidateNumber": "考生号",
    "status": "在读情况",
    "collegeName": "所在院系",
    "majorName": "所在专业",
    "className": "所在班级",
    "entryDate": "入学时间",
    "graduationSchool": "毕业高中",
    "domicile": "籍贯",
    "phoneNumber": "电话号码",
    "parentsNumber": "家长号码",
    "email": "电子邮箱",
    "politicalStatus": "政治面貌",
    "national": "民族",
    "education": "学历",
    "postalCode": "邮编",
    "grade": "年级"
}
```

## 学业情况

```json
{
    "gpa":"平均学分绩点GPA",
    "ipa":"计划内总课程数",
    "ipp":"计划内已过课程数",
    "ipf":"计划内未过课程数",
    "ipn":"计划内未修课程数",
    "ipi":"计划内在读课程数",
    "opp":"计划外已过课程数",
    "opf":"计划外未过课程数",
    "tsData":{
        "tsPoint":{
            "tsr":"通识教育要求学分",
            "tsg":"通识教育已得学分",
            "tsn":"通识教育未得学分",
        },
        "tsItems":[{
            "courseTitle":"课程名程",
            "courseId":"课程号",
            "courseSituation":"修读状态",
            "courseTerm":"修读学期",
            "courseCategory": "课程类别",
            "courseAttribution": "课程性质",
            "maxGrade":"最高成绩",
            "credit":"课程学分",
            "gradePoint":"课程绩点",
        }],
        },
    "tzdata":{
        "tzPoint":{
            "tzr":"拓展教育要求学分",
            "tzg":"拓展教育已得学分",
            "tzn":"拓展教育未得学分",
        },
        "tzItems":[{
            "courseTitle":"课程名程",
            "courseId":"课程号",
            "courseSituation":"修读状态",
            "courseTerm":"修读学期",
            "courseCategory": "课程类别",
            "courseAttribution": "课程性质",
            "maxGrade":"最高成绩",
            "credit":"课程学分",
            "gradePoint":"课程绩点",
        }],
        },
    "zydata":{
        "zyPoint":{
            "zyr":"专业教育要求学分",
            "zyg":"专业教育已得学分",
            "zyn":"专业教育未得学分",
        },
        "zyItems":[{
            "courseTitle":"课程名程",
            "courseId":"课程号",
            "courseSituation":"修读状态",
            "courseTerm":"修读学期",
            "courseCategory": "课程类别",
            "courseAttribution": "课程性质",
            "maxGrade":"最高成绩",
            "credit":"课程学分",
            "gradePoint":"课程绩点",
        }],
        },
    "qtdata":{
        "qtPoint":"{其它课程一般无学分要求}",
        "qtItems":[{
            "courseTitle":"课程名程",
            "courseId":"课程号",
            "courseSituation":"修读状态",
            "courseTerm":"修读学期",
            "courseCategory": "课程类别",
            "courseAttribution": "课程性质",
            "maxGrade":"最高成绩",
            "credit":"课程学分",
            "gradePoint":"课程绩点",
        }],
        },
}
```

## 停补课消息

```json
[
    {
        "message": "消息内容", 
        "ctime": "消息创建时间"
    }
]
```

## 成绩信息

```json
{
    "name": "学生姓名",
    "studentId": "学生学号",
    "schoolYear": "查询学年",
    "schoolTerm": "查询学期",
    "course": [{
        "courseTitle": "课程名程",
        "teacher": "课程老师",
        "courseId": "课程号",
        "className": "教学班名称",
        "courseNature": "课程性质",
        "credit": "课程学分",
        "grade": "课程成绩",
        "gradePoint": "课程绩点",
        "gradeNature": "考试性质",
        "startCollege": "授课院系",
        "courseMark": "主/选修",
        "courseCategory": "课程类别",
        "courseAttribution": "课程方向"
    }]
}
```

## 课表信息
```json
{
    "name": "学生姓名",
    "studentId": "学生学号",
    "schoolYear": "查询学年",
    "schoolTerm": "查询学期",
    "normalCourse": [{
        "courseTitle": "课程名程",
        "courseTitleShort":"课程短名称(超过x个字符显示省略号)",
        "teacher": "课程老师",
        "courseId": "课程号",
        "courseWeekday":"星期几",
        "courseSection": "课程节数",
        "courseWeek": "课程周数",
        "exam":"考试性质",
        "campus": "上课校区",
        "courseRoom": "上课地点",
        "className": "教学班名称",
        "hoursComposition": "学时",
        "weeklyHours": "周学时",
        "totalHours": "总学时",
        "credit": "课程学分"
    }],
}
```

## 已选课程

```json
{
    "courseNumber":"已选课程数",
    "items":[{
        "courseTitle":"课程名程",
        "courseCategory":"课程类别",
        "teacher":"课程老师",
        "teacher_id":"老师ID",
        "classId":"教学班ID",
        "classVolume":"教学班容量",
        "classPeople":"教学班已选人数",
        "courseRoom":"上课地点",
        "courseId":"课程号",
        "courseTime":"上课时间",
        "credit":"课程学分",
        "chooseSelf":"是否自选",
        "waiting":"是否待筛选"
        }]
}
```

## 板块课列表

```json
{
    "courseNumber":"教学班数量",
    "items":[{
        "courseTitle":"课程名程",
        "teacher":"课程老师",
        "teacher_id":"老师ID",
        "classId":"教学班ID",
        "doId":"执行ID",
        "classVolume":"教学班容量",
        "classPeople":"教学班已选人数",
        "courseRoom":"上课地点",
        "courseId":"课程号",
        "courseTime":"上课时间",
        "credit":"课程学分"
        }]
}
```